# 運用・保守ドキュメント完成版

## 📚 ドキュメント構成
1. **店舗スタッフ向け操作マニュアル**
2. **トラブルシューティングガイド**
3. **システム管理者向け運用手順書**

---

# 1. 店舗スタッフ向け操作マニュアル

## 🎯 はじめに
このシンプル予約管理アプリは、紙の予約表をデジタル化したものです。
従来の予約表と同じ感覚で、より便利に使用できます。

## 🚀 初回利用時の設定

### アプリへのアクセス
1. **ブラウザを開く**
   - Chrome、Safari、Edgeなどのブラウザを使用
   - URL: `https://your-salon-app.web.app` にアクセス

2. **ログイン**
   ```
   メールアドレス: salon@example.com
   パスワード: [店長から聞いてください]
   ```

3. **初回設定**
   - 設定 > アクセシビリティ設定で文字サイズなどを調整
   - キーボードショートカットの確認（F1キーでヘルプ表示）

## 📅 基本的な使い方

### 画面の見方
```
┌─────────────────────────────────────┐
│ ○○美容室 予約管理    2024年1月15日(月) │← ヘッダー
├─────────────────────────────────────┤
│ 時間 │ 月  火  水  木  金  土  日     │← カレンダー
├──────┼─────────────────────────────┤
│09:00 │ 田中│    │佐藤│    │    │    │← 予約表示
│09:30 │ 様  │    │様  │    │    │    │
│10:00 │ ✂️ │    │🎨  │    │    │    │← カテゴリー
├──────┼─────────────────────────────┤
│      │[新規予約ボタン]  [設定]  [ヘルプ]│← 操作ボタン
└─────────────────────────────────────┘
```

### カテゴリーの色分け
- ✂️ **カット**: 淡いピンク
- 🎨 **カラー**: 淡い青
- 〰️ **パーマ**: 淡い緑
- 💧 **トリートメント**: 淡いオレンジ
- 💄 **セット**: 淡い紫
- ⚪ **その他**: 薄いグレー

## ➕ 新規予約の作成

### 手順1: 新規予約開始
**方法A: 時間枠をクリック**
1. 予約したい日時の空白部分をクリック
2. 自動で新規予約画面が開きます

**方法B: 新規予約ボタン**
1. 画面下部の「新規予約」ボタンをクリック
2. 日時を選択してください

**方法C: キーボード**
1. `N`キーを押す（New予約の意味）
2. 新規予約画面が開きます

### 手順2: 予約情報の入力
```
┌─────────────────────────┐
│ 新規予約                │
├─────────────────────────┤
│ 日付: [2024-01-15] ▼   │← 必須項目
│ 時間: [10:00]      ▼   │← 必須項目
├─────────────────────────┤
│ お名前: [田中 花子]     │← 必須項目
│ 電話番号: [090-1234]    │← 任意
├─────────────────────────┤
│ カテゴリー:             │
│ ✂️[カット] 🎨[カラー]    │← どれか選択必須
│ 〰️[パーマ] 💧[トリートメント]│
├─────────────────────────┤
│ 詳細・メモ:             │
│ [カット+カラー希望      │← 自由記入
│  前回と同じ長さで]      │
├─────────────────────────┤
│ [キャンセル] [予約作成]  │
└─────────────────────────┘
```

### 入力のコツ
- **お名前**: 姓名で入力（例: 田中 花子）
- **電話番号**: ハイフンありなし どちらでもOK
- **詳細欄**: 前回の履歴、希望、注意事項など自由に記入

## ✏️ 予約の編集・変更

### 編集方法
1. **編集したい予約をクリック**
2. 編集画面が開きます
3. 必要な項目を変更
4. 「更新」ボタンをクリック

### よくある変更
**時間変更**
```
元: 10:00 → 変更後: 10:30
手順: 時間欄で「10:30」を選択 → 更新
```

**カテゴリー追加**
```
元: カットのみ → 変更後: カット+カラー
手順: カラーもチェック → 更新
```

**ステータス変更**
```
予約済み → 確認済み → 来店完了
手順: ステータス欄で該当するものを選択 → 更新
```

## 🗑️ 予約の削除・キャンセル

### 削除手順
1. 削除したい予約をクリック
2. 編集画面で「削除」ボタンをクリック
3. 確認メッセージで「はい」をクリック

⚠️ **注意**: 削除した予約は元に戻せません

### キャンセル処理
削除ではなく「キャンセル」ステータスに変更することをお勧めします
1. 予約を編集
2. ステータスを「キャンセル」に変更
3. 詳細欄に「お客様都合でキャンセル」など記入

## 🔍 予約の検索・確認

### 日付移動
- **前日/翌日**: 左右の矢印ボタン
- **特定日**: カレンダーアイコンから日付選択
- **キーボード**: 左右矢印キー

### 予約確認
- **予約をクリック**: 詳細が表示されます
- **当日の予約一覧**: 画面右側に表示
- **今週の予約**: 週表示で確認

## ⚙️ 便利な機能

### キーボードショートカット
- `N`: 新規予約作成
- `E`: 選択中の予約を編集
- `←/→`: 日付移動
- `F1`: ヘルプ表示
- `Escape`: 画面を閉じる

### 設定変更
1. 画面右上の「設定」をクリック
2. お好みに合わせて調整
   - 文字サイズ: 大きく/標準
   - 色合い: 高コントラスト/標準
   - 音声: ON/OFF

## 📱 複数端末での使用

### 同時使用の注意点
- **リアルタイム同期**: 他の端末での変更は即座に反映されます
- **競合時**: 「他のスタッフも編集中」というメッセージが表示
- **対処法**: メッセージに従って、適切に対応してください

### 推奨環境
- **PC**: Chrome、Edge、Firefox最新版
- **タブレット**: iPad（Safari）、Android（Chrome）
- **スマートフォン**: iPhone（Safari）、Android（Chrome）

---

# 2. トラブルシューティングガイド

## 🚨 よくある問題と解決方法

### ログイン関連

#### Q1: ログインできない
**症状**: メールアドレス・パスワードを入力してもログインできない

**解決方法**:
1. **入力内容確認**
   - メールアドレスに誤字はないか
   - パスワードの大文字小文字は正しいか
   - スペースが入っていないか

2. **ブラウザの問題**
   ```
   手順:
   1. ブラウザを再起動
   2. キャッシュをクリア (Ctrl+Shift+Delete)
   3. 別のブラウザで試す
   ```

3. **ネットワーク確認**
   - WiFiに接続されているか
   - 他のサイトは見れるか

**それでも解決しない場合**: システム管理者に連絡

#### Q2: パスワードを忘れた
**対処法**:
1. システム管理者に新しいパスワードを依頼
2. 一時的に他のスタッフのアカウントで作業
3. 紙の予約表に一時的に記録

### 操作関連

#### Q3: 予約が保存されない
**症状**: 予約作成・編集しても保存されない

**チェックポイント**:
1. **必須項目の確認**
   - お名前: 入力済みか
   - 日付: 選択済みか
   - 時間: 選択済みか
   - カテゴリー: 選択済みか

2. **エラーメッセージの確認**
   ```
   よくあるエラー:
   - 「過去の日付は選択できません」
     → 今日以降の日付を選択
   - 「時間が重複しています」
     → 別の時間を選択
   - 「お名前を入力してください」
     → 名前欄に入力
   ```

3. **インターネット接続確認**
   - 画面上部に「オフライン」表示がないか
   - 他のページは表示されるか

#### Q4: 他の人の予約が見えない
**症状**: 同僚が入力した予約が表示されない

**解決方法**:
1. **画面更新**: F5キーまたは更新ボタン
2. **時間待機**: 最大30秒待ってみる
3. **ブラウザ再起動**: 完全に閉じて再度開く

#### Q5: 画面が真っ白になった
**症状**: 突然画面が真っ白、または表示がおかしい

**緊急対処法**:
1. **ページ再読み込み**: F5キーを押す
2. **ブラウザ再起動**: 完全に閉じて再度開く
3. **別の端末で確認**: 他のPC・タブレットで開く

**データ保護**:
- 入力途中のデータは自動保存されています
- 慌てずに上記の手順を試してください

### 表示関連

#### Q6: 文字が小さすぎる・見えにくい
**解決方法**:
1. **ブラウザのズーム**: Ctrl + プラスキー
2. **アプリ設定**: 設定 > 大きな文字表示ON
3. **高コントラスト**: 設定 > 高コントラスト表示ON

#### Q7: 色が分からない・区別がつかない
**解決方法**:
1. カテゴリーはアイコンでも区別できます
   - ✂️ = カット
   - 🎨 = カラー
   - 〰️ = パーマ
2. 予約をクリックすると詳細が確認できます
3. 設定で高コントラスト表示を有効にしてください

### データ関連

#### Q8: 予約が消えた・見つからない
**確認手順**:
1. **日付確認**: 正しい日付を表示しているか
2. **全ステータス確認**: キャンセル予約も表示するか設定確認
3. **検索機能**: お客様名で検索してみる

**データ復旧**:
- データは自動的にバックアップされています
- 見つからない場合はシステム管理者に連絡

#### Q9: 間違って削除してしまった
**対処法**:
1. **すぐにシステム管理者に連絡**
2. **削除したデータの詳細を覚えている範囲で報告**
   - お客様名
   - 日時
   - 削除したおおよその時刻
3. **バックアップから復旧可能です** (24時間以内なら確実)

## 🔧 システム関連トラブル

### 動作が重い・遅い

#### 解決方法
1. **他のアプリを閉じる**: 不要なブラウザタブ・アプリを終了
2. **ブラウザ再起動**: 定期的に再起動
3. **PC再起動**: 1日1回程度

### インターネット接続問題

#### WiFi接続トラブル
1. **WiFi再接続**
   ```
   手順:
   1. WiFi設定を開く
   2. 現在の接続を切断
   3. 再度接続
   ```

2. **モバイル回線使用**
   - スマートフォンのテザリング機能を使用
   - 一時的な回避策として有効

3. **オフライン対応**
   - アプリはオフラインでも一部操作可能
   - 接続復旧時に自動同期されます

## 📞 緊急時の対応

### システムが全く使えない場合

#### 一時的対応
1. **紙の予約表に戻す**
   - 手書きで予約を記録
   - システム復旧後に入力

2. **他の端末を試す**
   - スマートフォン
   - 別のPC・タブレット

3. **連絡体制**
   ```
   優先順位:
   1. システム管理者に連絡
   2. 店長に報告
   3. 他店舗に応援依頼（必要に応じて）
   ```

### データ消失の疑い

#### 即座に行うこと
1. **操作を停止**: 追加の操作は行わない
2. **状況記録**: 何をしていたか、いつ頃かを記録
3. **管理者連絡**: 最優先でシステム管理者に連絡

#### 記録すべき情報
- 発生時刻
- 操作内容
- エラーメッセージ（あれば）
- 影響範囲（どの予約が関係するか）

---

# 3. システム管理者向け運用手順書

## 🔐 システム管理業務概要

### 日次業務 (5分)
- システム稼働状況確認
- バックアップ実行確認
- エラーログチェック

### 週次業務 (15分)
- パフォーマンス監視
- セキュリティ状況確認
- ユーザーアカウント管理

### 月次業務 (30分)
- システム更新・パッチ適用
- データ容量・使用量確認
- バックアップデータ確認

## 🖥️ Firebase管理コンソール

### アクセス方法
1. **Firebase Console**: https://console.firebase.google.com/
2. **プロジェクト選択**: [美容室名]-reservation-system
3. **管理者権限**: システム管理者アカウントでログイン

### 主要メニュー
```
Firebase Console
├── Authentication    # ユーザー管理
├── Firestore        # データベース管理
├── Hosting          # アプリ公開管理
├── Storage          # ファイル管理（未使用）
├── Functions        # サーバー処理（未使用）
└── Analytics        # 使用状況分析
```

## 👥 ユーザー管理

### 新規ユーザー追加
1. **Authentication > Users**
2. **「ユーザーを追加」クリック**
3. **情報入力**:
   ```
   メールアドレス: staff@salon.com
   パスワード: [自動生成または指定]
   メールアドレス確認済み: ✓
   ```
4. **カスタムクレーム設定**:
   ```json
   {
     "role": "staff",
     "storeId": "salon001",
     "permissions": ["read", "write"]
   }
   ```

### パスワードリセット
1. **該当ユーザーを選択**
2. **「パスワードをリセット」**
3. **一時パスワードを店舗に通知**

### ユーザー無効化
```
手順:
1. Authentication > Users
2. 該当ユーザー選択
3. 「ユーザーを無効にする」
4. 理由を記録（退職、一時停止など）
```

## 💾 データベース管理

### Firestore構造
```
/reservations/{reservationId}
  ├── id: string
  ├── date: string (YYYY-MM-DD)
  ├── time: string (HH:MM)
  ├── customerName: string
  ├── customerPhone: string
  ├── category: string
  ├── details: string
  ├── status: string
  ├── createdAt: timestamp
  ├── updatedAt: timestamp
  └── createdBy: string

/settings/{settingId}
  ├── businessHours: object
  ├── categories: array
  └── storeInfo: object
```

### データ監視
1. **Firestore > データ**
2. **使用量確認**: 読み取り・書き込み回数
3. **異常パターン検出**: 大量アクセス・エラー多発

### データエクスポート
```bash
# Firebase CLI使用
firebase firestore:export gs://your-bucket/backup-$(date +%Y%m%d)

# 手動エクスポート
1. Firestore > エクスポート/インポート
2. コレクション選択: reservations, settings
3. Cloud Storage バケット指定
4. エクスポート実行
```

## 🔒 セキュリティ管理

### Security Rules確認
```javascript
// Firestore Rules (firestore.rules)
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /reservations/{document} {
      allow read, write: if request.auth != null 
        && request.auth.token.role == "staff";
    }
    
    match /settings/{document} {
      allow read: if request.auth != null;
      allow write: if request.auth != null 
        && request.auth.token.role == "admin";
    }
  }
}
```

### 不正アクセス監視
1. **Authentication > 使用状況**
2. **異常ログイン検出**:
   - 深夜時間帯のアクセス
   - 複数回ログイン失敗
   - 不明なIPアドレス

3. **対処法**:
   - 該当アカウントの一時停止
   - パスワード強制変更
   - アクセスログ詳細調査

## 📊 監視・アラート設定

### パフォーマンス監視
```
監視項目:
- 応答時間 (< 2秒目標)
- エラー率 (< 1%目標)
- 同時接続数
- データベース使用量
```

### アラート設定
1. **Cloud Monitoring**設定
2. **アラートポリシー作成**:
   ```
   条件:
   - エラー率 > 5%
   - 応答時間 > 5秒
   - データベース使用量 > 80%
   
   通知先:
   - 管理者メール
   - SMS（緊急時のみ）
   ```

## 🔧 バックアップ・復旧

### 自動バックアップ設定
```bash
# Cloud Scheduler + Cloud Functions
exports.dailyDatabaseBackup = functions.pubsub
  .schedule('0 3 * * *') // 毎日3:00
  .timeZone('Asia/Tokyo')
  .onRun(async (context) => {
    const backup = await firestore.bulkWriter();
    // バックアップ処理
  });
```

### 手動バックアップ
```
頻度: 週1回（日曜日）
保存先: Google Cloud Storage
保存期間: 3ヶ月
```

### 復旧手順
1. **データ損失確認**: 影響範囲の特定
2. **最新バックアップ確認**: 復旧ポイントの決定
3. **復旧実行**:
   ```bash
   firebase firestore:import gs://your-bucket/backup-20240115
   ```
4. **整合性確認**: データの妥当性チェック
5. **ユーザー通知**: 復旧完了の通知

## 📈 使用状況分析

### 月次レポート作成
```
レポート項目:
1. アクティブユーザー数
2. 予約作成・編集・削除回数
3. システム稼働率
4. エラー発生状況
5. パフォーマンス実績
```

### データ活用
1. **使用パターン分析**:
   - ピーク時間帯の特定
   - よく使用される機能
   - エラーが多い操作

2. **改善提案**:
   - UI改善点
   - パフォーマンス最適化
   - 機能追加の優先度

## 🚨 インシデント対応

### 緊急事態対応フロー
```
Level 1: システム完全停止
├── 即座復旧作業開始（目標15分以内）
├── ユーザーへ緊急通知
├── 代替手段提供（紙ベース）
└── 原因調査・恒久対策

Level 2: 機能制限
├── 影響範囲特定（30分以内）
├── 回避策提供
├── 修正作業実施
└── テスト・検証

Level 3: 軽微な問題
├── 24時間以内対応
├── ユーザーへ情報提供
└── 計画的修正実施
```

### 連絡体制
```
緊急度順:
1. システム管理者（第一対応）
2. 店長・責任者
3. スタッフ全員
4. 技術サポート（外部）
```

## 🔄 定期メンテナンス

### システム更新
```
頻度: 月1回（第3日曜日）
時間: 営業時間外（22:00-24:00）

手順:
1. 事前通知（1週間前）
2. バックアップ実行
3. 更新適用
4. 動作確認
5. 完了通知
```

### データクリーンアップ
```
対象:
- 1年以上前の予約データ（アーカイブ）
- エラーログ（3ヶ月保持）
- 一時ファイル（週次削除）
```

## 📋 運用チェックリスト

### 日次確認項目
- [ ] システム稼働確認 (営業時間前)
- [ ] バックアップ実行確認
- [ ] エラーログ確認
- [ ] 使用状況モニタリング
- [ ] ユーザーからの問い合わせ対応

### 週次確認項目
- [ ] パフォーマンス分析
- [ ] セキュリティ状況確認
- [ ] データ容量チェック
- [ ] 手動バックアップ実行
- [ ] 運用ログ整理

### 月次確認項目
- [ ] システム更新・パッチ適用
- [ ] 使用状況レポート作成
- [ ] バックアップデータ確認・整理
- [ ] セキュリティ監査
- [ ] 運用改善検討

---

**📋 この包括的運用・保守ドキュメントにより、美容室スタッフが安心してシステムを使用でき、システム管理者が効率的に運用できる環境を提供します。**